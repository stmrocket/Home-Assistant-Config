input_boolean:  
  drip_irrigation_enabled:
    name: Drip Irrigation Enabled
    icon: mdi:timer-outline

input_number:
  drip_irrigation_duration:
    name: Drip Irrigation duration
    min: 1
    max: 60
    step: 1
    mode: box

sensor:
  - platform: template
    sensors:
      program_drip_status:
        unique_id: 697a92e1-35f7-4788-a643-d6c8f43e5568
        friendly_name: Irrigation Schedule Drip Status
        value_template: >-
          {% if is_state('input_boolean.drip_irrigation_enabled', 'on') and is_state('switch.back_drip_valve', 'off') -%}
            enabled
          {% elif  is_state('input_boolean.drip_irrigation_enabled', 'on') and is_state('switch.back_drip_valve', 'on') -%}
            running
          {% else -%}
            disabled
          {% endif -%}

automation:
  - alias: Run Back Drip Irrigation
    id: 8fc4dd84-9231-4abc-a32b-4b6252ac7f89
    trigger:
      - platform: sun
        event: sunrise
    condition:
      - condition: state
        entity_id: input_boolean.drip_irrigation_enabled
        state: 'on'
    action:
      - service: switch.turn_on
        entity_id: switch.back_drip_valve

  - alias: Stop Back Drip Irrigation
    id: 8a752a04-9c63-49af-9643-7a3ff9e32ef7
    trigger:
      - platform: state
        entity_id: switch.back_drip_valve
        to: "on"
        for:
          minutes: "{{ states('input_number.drip_irrigation_duration')|int }}"
    action:
      - service: switch.turn_off
        entity_id: switch.back_drip_valve

  - alias: B-hyve next watering & rain delay finishing updater
    id: 20a14c8e-84aa-4782-91c9-2e09677c9184
    trigger:
      - platform: state
        entity_id: switch.east_front_zone, switch.rain_delay_lawn
      - platform: homeassistant
        event: start
    action:
      - service: python_script.bhyve_next_watering
        data:
          entity_id: switch.lawn_rain_delay