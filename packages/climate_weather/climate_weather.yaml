sensor:
  - platform: template
    sensors:
      pws_url:
        unique_id: 9b310612-c75f-4b73-8ab9-dadd0e78a176
        value_template: !secret pws_url

      weather_description:
        unique_id: 000cea9f-418c-43cc-9c1d-1635e560fd07
        value_template: >-
          {% if is_state('input_boolean.is_raining','on') -%}
            {{ states('sensor.openweathermap_current_weather_alerts') }}  Rain now.  {{ states('sensor.openweathermap_weekly_summary') }}
          {% else -%}
          {{ states('sensor.openweathermap_current_weather_alerts') }}  {{ states('sensor.openweathermap_weekly_summary') }}
          {% endif -%}
      
      local_apparent_temperature:
        unique_id: ea5a7b4f-9cb5-4774-9360-5d92d52cd7c6
        value_template: >-
          {% set temp = (states('sensor.acurite_ws_temperature') | float(0) - 32) * (5/9) %}
          {% set ws = states('sensor.acurite_ws_wind_speed') | float(0) / 2.237 %}
          {% set p = (states('sensor.acurite_ws_humidity') | float(0) / 100) * 6.105 * e**((17.27 * temp) / (237.7 + temp)) %}
          {% set atc = temp + (0.33 * p) - (0.70 * ws) - 4 %}
          {% set at = (atc * (9/5)) + 32 %}
          {{ at }}
        unit_of_measurement: "°F"
        device_class: temperature

      local_uv_risk:
        unique_id: 5b4f6c6c-95ba-4161-b7ee-4a09e8376035
        value_template: >-
          {% if states("sensor.acurite_ws_uv_index") | int(0) >= 0 and states("sensor.acurite_ws_uv_index") | int(0) <= 2 -%}
            Low
          {%- elif states("sensor.acurite_ws_uv_index") | int(0) > 2 and states("sensor.acurite_ws_uv_index") | int(0) <= 5 -%}
            Moderate
          {%- elif states("sensor.acurite_ws_uv_index") | int(0) > 5 and states("sensor.acurite_ws_uv_index") | int(0) <= 7 -%}
            High
          {%- elif states("sensor.acurite_ws_uv_index") | int(0) > 7 and states("sensor.acurite_ws_uv_index") | int(0) <= 10 -%}
            Very High
          {%- elif states("sensor.acurite_ws_uv_index") | int(0) > 10 -%}
            Extreme
          {%- endif %}  

      local_uv_combined:
        unique_id:  66433b12-f157-4564-b5eb-37143851387d
        value_template: '{{ states("sensor.local_uv_risk") }} - {{ states("sensor.acurite_ws_uv_index") }}'

      temp_high_overall:
        unique_id: a4fbbd9b-6fcb-49f1-a436-c5bceaeedd25
        value_template: "{{ states('input_number.temp_high_overall') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_overall:
        unique_id: 7f85a7fc-99a8-48e3-92c2-499160abb95d
        value_template: "{{ states('input_number.temp_low_overall') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_day:
        unique_id: 9f0d2fc8-d601-4d48-8dff-ded2d97e4749
        value_template: "{{ states('input_number.temp_high_day') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_day:
        unique_id: fdeebfac-5529-452f-b722-25d88e2b0d5c
        value_template: "{{ states('input_number.temp_low_day') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_week:
        unique_id: 938ad2bf-4ad5-44d4-af70-3f4d1509cf72
        value_template: "{{ states('input_number.temp_high_week') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_week:
        unique_id: d769b528-60e3-4d53-bc9e-3218b28767a5
        value_template: "{{ states('input_number.temp_low_week') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month:
        unique_id: fbb7ee84-b101-4027-973f-0433e16d8285
        value_template: "{{ states('input_number.temp_high_month') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month:
        unique_id: 6d078100-57fe-42bc-b0e9-2d7324029b0c
        value_template: "{{ states('input_number.temp_low_month') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_year:
        unique_id: 56f83d4e-a60f-4d2f-9e43-d6209231f971
        value_template: "{{ states('input_number.temp_high_year') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_year:
        unique_id: c5f83210-0131-4560-9853-030bab5a6bde
        value_template: "{{ states('input_number.temp_low_year') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_1:
        unique_id: fd015f9a-9b74-4ffc-a65c-6e63580e3578
        value_template: "{{ states('input_number.temp_high_month_1') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_1:
        unique_id: 4eec2945-9c28-40ff-92d6-9b4385225953
        value_template: "{{ states('input_number.temp_low_month_1') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_2:
        unique_id: a8cb2f31-138f-4801-a4b5-6b1345125d50
        value_template: "{{ states('input_number.temp_high_month_2') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_2:
        unique_id: 4fe1ddbd-8bea-412d-9f67-44853677db41
        value_template: "{{ states('input_number.temp_low_month_2') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_3:
        unique_id: 3fb64b48-3b80-4a5a-9bd8-f6b13039f848
        value_template: "{{ states('input_number.temp_high_month_3') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_3:
        unique_id: 2c0ac36e-937c-4a1b-acf0-8a83910073d4
        value_template: "{{ states('input_number.temp_low_month_3') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_4:
        unique_id: 8713b630-085d-4e10-9bc7-224cb0914d97
        value_template: "{{ states('input_number.temp_high_month_4') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_4:
        unique_id: a55dc4d4-97d5-4fd9-b043-3a1bf1e21bc0
        value_template: "{{ states('input_number.temp_low_month_4') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_5:
        unique_id: 47a55b83-812d-4795-89b1-6a8a6dea56cc
        value_template: "{{ states('input_number.temp_high_month_5') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_5:
        unique_id: 58bd06a4-4c98-4a6a-8b42-0646baca3046
        value_template: "{{ states('input_number.temp_low_month_5') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_6:
        unique_id: 8f7712d4-2e63-445e-a0cb-0d3c2f6e7f11
        value_template: "{{ states('input_number.temp_high_month_6') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_6:
        unique_id: 520698f2-be05-4a5b-9feb-804e1e4d1610
        value_template: "{{ states('input_number.temp_low_month_6') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_7:
        unique_id: a9a9360a-3a2b-49e9-b066-eda4f7ee61dc
        value_template: "{{ states('input_number.temp_high_month_7') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_7:
        unique_id: 335316a3-4a7c-47c5-b01e-b6636a7604ff
        value_template: "{{ states('input_number.temp_low_month_7') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_8:
        unique_id: 252b8c2e-9a11-4058-9d23-76154a23764e
        value_template: "{{ states('input_number.temp_high_month_8') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_8:
        unique_id: 867b44cd-8a3e-45a4-b0ef-63d0bdabc869
        value_template: "{{ states('input_number.temp_low_month_8') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_9:
        unique_id: 4019589e-f6fd-4928-b1d6-200df2a6ac1a
        value_template: "{{ states('input_number.temp_high_month_9') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_9:
        unique_id: d19a9935-0553-4f06-88c2-249c3212d548
        value_template: "{{ states('input_number.temp_low_month_9') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_10:
        unique_id: b54868d1-a8cd-418f-b6ae-1023ee51e1f1
        value_template: "{{ states('input_number.temp_high_month_10') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_10:
        unique_id: 69c76273-3769-4f1b-8bcd-d84efceaec95
        value_template: "{{ states('input_number.temp_low_month_10') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_11:
        unique_id: e7a80443-5ead-4110-89a8-c90ec777662d
        value_template: "{{ states('input_number.temp_high_month_11') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_11:
        unique_id: ec74d6fc-5c90-4928-bcbd-05a5125c6202
        value_template: "{{ states('input_number.temp_low_month_11') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_high_month_12:
        unique_id: ba70cc0e-f565-4aee-8ae2-062d3315ec02
        value_template: "{{ states('input_number.temp_high_month_12') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

      temp_low_month_12:
        unique_id: 1650eed3-7762-498d-8bc4-81f66b8da975
        value_template: "{{ states('input_number.temp_low_month_12') | float(none) | round(1, default=none) }}"
        unit_of_measurement: "°F"
        device_class: temperature

  - platform: statistics
    name: Local Wind Gust 2 Minute
    unique_id: 82ac1f0c-2e2b-4fa3-a76b-68ed87f39833
    entity_id: sensor.acurite_ws_wind_speed_buffered
    state_characteristic: value_max
    max_age:
      minutes: 2
        
  - platform: statistics
    name: Local Wind Gust 10 Minute
    unique_id: 717aeaac-2fa1-48db-96e7-b151be95f843
    entity_id: sensor.acurite_ws_wind_speed_buffered
    state_characteristic: value_max
    max_age:
      minutes: 10

  - platform: statistics
    name: Local Wind Speed 2 Minute Average
    unique_id: 1fffa5b0-9677-4c22-a8c9-73ed194013a1
    entity_id: sensor.acurite_ws_wind_speed_buffered
    state_characteristic: mean
    max_age:
      minutes: 2

  - platform: statistics
    name: Local Wind Direction 2 Minute Average
    unique_id: a9dd1b0c-f51f-40cd-9846-3a7a30b69cf5
    entity_id: sensor.acurite_ws_wind_direction_buffered
    state_characteristic: mean
    max_age:
      minutes: 2

  - platform: filter
    name: Filtered AcuRite Atlas Temperature
    entity_id: sensor.acurite_atlas_temperature
    filters:
      - filter: outlier
        window_size: 7
        radius: 5

  - platform: filter
    name: Filtered AcuRite Outside Temperature
    entity_id: sensor.acurite_outside_temperature
    filters:
      - filter: outlier
        window_size: 7
        radius: 5

template:
  - sensor:
    - name: AcuRite WS Wind Speed Buffered
      unique_id: bb04804b-cad8-4bda-9124-e249215761aa
      unit_of_measurement: "mph"
      device_class: wind_speed
      state_class: measurement
      state: "{{ states('sensor.acurite_ws_wind_speed') }}"
      attributes:
          minute_counter: "{{ now().minute }}"
    
    - name: AcuRite WS Wind Direction Buffered
      unique_id: f220269c-ee0b-4024-bc93-d74b4ed7cdf7
      unit_of_measurement: "°"
      state_class: measurement
      state: "{{ states('sensor.acurite_ws_wind_direction') }}"
      attributes:
          minute_counter: "{{ now().minute }}"
    
    - name: AcuRite WS Temperature
      unique_id: cc9cd34a-58bd-4bf4-93ab-233c083b23ca
      unit_of_measurement: "°F"
      state_class: measurement
      device_class: temperature
      state: >-
        {% if is_state("input_boolean.atlas_bad", "on") -%}
          {{ states("sensor.filtered_acurite_atlas_temperature")}}
        {%- else -%}
          {{ states("sensor.filtered_acurite_outside_temperature")}}
        {%- endif %}
    
    - name: AcuRite WS Humidity
      unique_id: 6adbb1d5-4e59-42bb-a81a-e903c020822d
      unit_of_measurement: "%"
      state_class: measurement
      state: >-
        {% if is_state("input_boolean.atlas_bad", "on") -%}
          {{ states("sensor.acurite_atlas_humidity")}}
        {%- else -%}
          {{ states("sensor.acurite_outside_humidity")}}
        {%- endif %}
    
    - name: AcuRite WS Wind Speed
      unique_id: dd5eea55-1080-4b2e-9b7a-88c6da0f08b2
      unit_of_measurement: "mph"
      state_class: measurement
      state: >-
        {% if is_state("input_boolean.atlas_bad", "off") -%}
          {{ states("sensor.acurite_atlas_wind_speed")}}
        {%- else -%}
          {{ states("sensor.acurite_iris_wind_speed")}}
        {%- endif %}
    
    - name: AcuRite WS Wind Direction
      unique_id: fc565c10-6583-4165-ad91-b07267b94aaf
      unit_of_measurement: "°"
      state_class: measurement
      state: >-
        {% if is_state("input_boolean.atlas_bad", "off") -%}
          {{ states("sensor.acurite_atlas_wind_direction")}}
        {%- else -%}
          {{ states("sensor.acurite_iris_wind_direction")}}
        {%- endif %}
    
    - name: AcuRite WS Cumulative Rainfall
      unique_id: 855f360c-c676-4e47-92c1-2fd992541ecd
      unit_of_measurement: "in"
      state_class: measurement
      state: >-
        {% if is_state("input_boolean.atlas_bad", "off") -%}
          {{ states("sensor.acurite_atlas_cumulative_rainfall")}}
        {%- else -%}
          {{ states("sensor.acurite_iris_cumulative_rainfall")}}
        {%- endif %}
    
    - name: AcuRite WS UV Index
      unique_id: 0c2e9d4a-8da6-4b1e-a3c0-c3d257187996
      unit_of_measurement: "UV index"
      state_class: measurement
      state: >-
        {% if is_state("input_boolean.atlas_bad", "off") -%}
          {{ states("sensor.acurite_atlas_uv_index")}}
        {%- else -%}
          {{ states("sensor.openweathermap_current_uv_index")}}
        {%- endif %}



mqtt:
  sensor:
    - name: Bear Creek Elevation
      unique_id: 40504a14-2547-4aab-931b-12d0b7f2b6ed
      state_topic: "hcfws/elevation"
      unit_of_measurement: "ft"

    - name: Bear Creek Rain This Hour
      unique_id: 67361785-e52e-44b8-bc0f-ccd2f2e5773d
      state_topic: "hcfws/rain/current"
      unit_of_measurement: "in"

    - name: Bear Creek Rain Last Hour
      unique_id: 61531c54-9153-4890-b858-e98b80765412
      state_topic: "hcfws/rain/last"
      unit_of_measurement: "in"

    #OpenWeatherMap
    - name: OpenWeatherMap Current Icon
      unique_id: f7c41cce-2a57-4071-9167-a0f0912dd4bc
      state_topic: openweathermap
      value_template: "{{value_json['current'].icon }}"

    - name: OpenWeatherMap Current Summary
      unique_id: 914fedae-8464-4e0a-8378-f8eee89e91cf
      state_topic: openweathermap
      value_template: "{{value_json['current'].summary }}"
      
    - name: OpenWeatherMap Current Temperature
      unique_id: e90de0c6-6d7b-44a8-b0e3-5da9af999fb3
      state_topic: openweathermap
      value_template: "{{value_json['current'].temperature }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Current Visibility
      unique_id: ea8ff52b-d3c8-4f8c-9cb1-d70452e7cf88
      state_topic: openweathermap
      value_template: "{{value_json['current'].visibility }}"
      unit_of_measurement: "mi"

    - name: OpenWeatherMap Current Maximum Temperature
      unique_id: 14ffd893-eebb-4aac-af6c-b098ff95e67b
      state_topic: openweathermap
      value_template: "{{value_json['current'].maxtemp }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Current Minimum Temperature
      unique_id: 2a5c986c-bb04-490b-b898-5102d684f860
      state_topic: openweathermap
      value_template: "{{value_json['current'].mintemp }}"
      unit_of_measurement: "°F"  
      device_class: temperature

    - name: OpenWeatherMap Current Wind Bearing
      unique_id: 2cc22f3c-8ba3-48cc-9503-5354fcec1510
      state_topic: openweathermap
      value_template: "{{value_json['current'].wind_dir }}"
      unit_of_measurement: "°"

    - name: OpenWeatherMap Current Wind Speed
      unique_id: 87930ea7-0228-41a2-9daf-930a72a3f26f
      state_topic: openweathermap
      value_template: "{{value_json['current'].wind_spd }}"
      unit_of_measurement: "mi/h"

    - name: OpenWeatherMap Current Wind Gust
      unique_id: b7f348f3-8499-4502-a1fa-42fb1958ac78
      state_topic: openweathermap
      value_template: "{{value_json['current'].wind_gust }}"
      unit_of_measurement: "mi/h"

    - name: OpenWeatherMap Current Humidity
      unique_id: 35219f91-1a43-4eb6-9a47-cf6a79d2200c
      state_topic: openweathermap
      value_template: "{{value_json['current'].humidity }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Current Pressure
      unique_id: cde82cb0-f07f-4d47-9215-83f1b99f1e9c
      state_topic: openweathermap
      value_template: "{{value_json['current'].pressure }}"
      unit_of_measurement: "hPa"

    - name: OpenWeatherMap Current Apparent Temperature
      unique_id: de0e0372-bcc3-460f-8fc1-e51d4057a097
      state_topic: openweathermap
      value_template: "{{value_json['current'].apparent }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Current POP
      unique_id: 89ced0b1-eef6-41ed-b5ab-cd628ff9977a
      state_topic: openweathermap
      value_template: "{{value_json['current'].precip_chance }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Current Precip Forecast
      unique_id: 3149a5f8-6f1f-46c2-9be9-bda30835d5f7
      state_topic: openweathermap
      value_template: "{{value_json['current'].precip_forecast }}"
      unit_of_measurement: "in"

    - name: OpenWeatherMap Current UV Index
      unique_id: ddf3ed07-1d98-4d4c-b48d-a63d12848f55
      state_topic: openweathermap
      value_template: "{{value_json['current'].uv_index }}"
      unit_of_measurement: "UV index"

    - name: OpenWeatherMap Current UV Risk
      unique_id: 7eab773f-6986-47fb-8a67-34c5c3fe7bc3
      state_topic: openweathermap
      value_template: "{{value_json['current'].uv_risk }}"

    - name: OpenWeatherMap Current UV Combined
      unique_id: bf0a1700-c174-4f6a-ac5d-e3b73cc940ea
      state_topic: openweathermap
      value_template: "{{value_json['current'].uv_combined }}"

    - name: OpenWeatherMap Day 1 Icon
      unique_id: bb9ccc98-2909-4065-9cc2-ef3d6e1a14f9
      state_topic: openweathermap
      value_template: "{{value_json['day_1'].icon }}"

    - name: OpenWeatherMap Day 1 Summary
      unique_id: 19bd4518-6b9c-4208-ae62-dd585082a626
      state_topic: openweathermap
      value_template: "{{value_json['day_1'].summary }}"

    - name: OpenWeatherMap Day 1 Maximum Temperature
      unique_id: 4ac9bb05-b0bb-4aba-8711-c7762f5e1fb2
      state_topic: openweathermap
      value_template: "{{value_json['day_1'].maxtemp }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Day 1 Minimum Temperature
      unique_id: c71ae86b-4c8b-40a6-9ee3-e0dc83039920
      state_topic: openweathermap
      value_template: "{{value_json['day_1'].mintemp }}"
      unit_of_measurement: "°F" 
      device_class: temperature 
      
    - name: OpenWeatherMap Day 1 POP
      unique_id: 63c09a34-27a7-443e-ba85-0fd5f86f6ea6
      state_topic: openweathermap
      value_template: "{{value_json['day_1'].precip_chance }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Day 1 Precip Forecast
      unique_id: fb2194f9-6dbd-4e28-a38e-f0440bc75abe
      state_topic: openweathermap
      value_template: "{{value_json['day_1'].precip_forecast }}"
      unit_of_measurement: "in"

    - name: OpenWeatherMap Day 2 Icon
      unique_id: e6fbe742-41e8-4acf-9f84-d43f494ba608
      state_topic: openweathermap
      value_template: "{{value_json['day_2'].icon }}"

    - name: OpenWeatherMap Day 2 Summary
      unique_id: bff6215a-b112-41c8-97e1-c0ef9ba2a4ae
      state_topic: openweathermap
      value_template: "{{value_json['day_2'].summary }}"

    - name: OpenWeatherMap Day 2 Maximum Temperature
      unique_id: 2185e3c4-d972-45fa-8e26-afb684fee43b
      state_topic: openweathermap
      value_template: "{{value_json['day_2'].maxtemp }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Day 2 Minimum Temperature
      unique_id: b681e147-e7da-4265-a020-765c05ed4fbd
      state_topic: openweathermap
      value_template: "{{value_json['day_2'].mintemp }}"
      unit_of_measurement: "°F" 
      device_class: temperature 

    - name: OpenWeatherMap Day 2 POP
      unique_id: 00109918-f889-4d0d-bd69-6f2f88ca6fa5
      state_topic: openweathermap
      value_template: "{{value_json['day_2'].precip_chance }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Day 2 Precip Forecast
      unique_id: 7f401e34-5f5d-447c-9550-fab57fcc7735
      state_topic: openweathermap
      value_template: "{{value_json['day_2'].precip_forecast }}"
      unit_of_measurement: "in"

    - name: OpenWeatherMap Day 3 Icon
      unique_id: acdb0525-b18f-4b93-8611-dedc1e653f33
      state_topic: openweathermap
      value_template: "{{value_json['day_3'].icon }}"

    - name: OpenWeatherMap Day 3 Summary
      unique_id: a68bc590-6ee3-462a-a871-11c128c295ee
      state_topic: openweathermap
      value_template: "{{value_json['day_3'].summary }}"

    - name: OpenWeatherMap Day 3 Maximum Temperature
      unique_id: 4c444ca9-3e0e-4de4-a375-7c50f9467dee
      state_topic: openweathermap
      value_template: "{{value_json['day_3'].maxtemp }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Day 3 Minimum Temperature
      unique_id: 65645f4e-37de-469c-b754-13a669625e73
      state_topic: openweathermap
      value_template: "{{value_json['day_3'].mintemp }}"
      unit_of_measurement: "°F"  
      device_class: temperature

    - name: OpenWeatherMap Day 3 POP
      unique_id: 6cd150f6-42e4-4549-bf6b-1a71e7701f2c
      state_topic: openweathermap
      value_template: "{{value_json['day_3'].precip_chance }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Day 3 Precip Forecast
      unique_id: 3681ea7b-2ebd-404c-86d8-40f89f30f636
      state_topic: openweathermap
      value_template: "{{value_json['day_3'].precip_forecast }}"
      unit_of_measurement: "in"

    - name: OpenWeatherMap Day 4 Icon
      unique_id: 321b3be6-c093-4dc7-b51a-bbaa34865663
      state_topic: openweathermap
      value_template: "{{value_json['day_4'].icon }}"

    - name: OpenWeatherMap Day 4 Summary
      unique_id: 176d2647-c5b7-416b-af32-5e58c1ce1148
      state_topic: openweathermap
      value_template: "{{value_json['day_4'].summary }}"

    - name: OpenWeatherMap Day 4 Maximum Temperature
      unique_id: bb073006-15a3-4d18-b4b5-4af9aa38a930
      state_topic: openweathermap
      value_template: "{{value_json['day_4'].maxtemp }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Day 4 Minimum Temperature
      unique_id: 823c30fb-7fda-46e7-ac11-ed1cc60b7752
      state_topic: openweathermap
      value_template: "{{value_json['day_4'].mintemp }}"
      unit_of_measurement: "°F"  
      device_class: temperature

    - name: OpenWeatherMap Day 4 POP
      unique_id: 50365ea4-43ba-4fd0-ad12-788a7b953312
      state_topic: openweathermap
      value_template: "{{value_json['day_4'].precip_chance }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Day 4 Precip Forecast
      unique_id: 8a1bca98-6871-4cc9-bebf-94f10e63f529
      state_topic: openweathermap
      value_template: "{{value_json['day_4'].precip_forecast }}"
      unit_of_measurement: "in"

    - name: OpenWeatherMap Day 5 Icon
      unique_id: 997357fe-4f12-4ba6-976a-419f904a89cb
      state_topic: openweathermap
      value_template: "{{value_json['day_5'].icon }}"

    - name: OpenWeatherMap Day 5 Summary
      unique_id: cbc6e082-88d1-4fc2-85bb-997016c60fc4
      state_topic: openweathermap
      value_template: "{{value_json['day_5'].summary }}"

    - name: OpenWeatherMap Day 5 Maximum Temperature
      unique_id: c6c2a1b6-8cc8-47ab-90b5-ef8ede122555
      state_topic: openweathermap
      value_template: "{{value_json['day_5'].maxtemp }}"
      unit_of_measurement: "°F"
      device_class: temperature

    - name: OpenWeatherMap Day 5 Minimum Temperature
      unique_id: abe261e2-73a2-4e68-85e1-6872d6ec0021
      state_topic: openweathermap
      value_template: "{{value_json['day_5'].mintemp }}"
      unit_of_measurement: "°F"  
      device_class: temperature

    - name: OpenWeatherMap Day 5 POP
      unique_id: 983fb0e1-4a4a-4f30-9b92-3b66ec3bdf96
      state_topic: openweathermap
      value_template: "{{value_json['day_5'].precip_chance }}"
      unit_of_measurement: "%"

    - name: OpenWeatherMap Day 5 Precip Forecast
      unique_id: 5926ec32-161a-45c1-a80e-2c13f11ab7b7
      state_topic: openweathermap
      value_template: "{{value_json['day_5'].precip_forecast }}"
      unit_of_measurement: "in"

    - name: OpenWeatherMap Current Weather Alerts
      unique_id: ecb53a39-5d75-4e5a-aa5e-6071ac46d74d
      state_topic: openweathermap
      value_template: "{{value_json['alerts'] }}"

    - name: OpenWeatherMap Weekly Summary
      unique_id: 760589da-4f9d-4c8f-b0e8-4bad3fcb10b5
      state_topic: openweathermap
      value_template: "{{value_json['summary'] }}"

    - name: KTME Current Visibility
      unique_id: f76c1bcd-45f4-42a3-ac5c-c99f20cb44c8
      state_topic: weather/ktme/visibility
      unit_of_measurement: "mi"

rest_command:
  update_wunderground:
    url: "{{ states('sensor.pws_url') }}tempf={{ states('sensor.acurite_ws_temperature') }}&humidity={{ states('sensor.acurite_ws_humidity') }}&dewptf={{ states('sensor.outside_dewpoint') | float | round(2, default=none) }}&baromin={{ states('sensor.den_climate_pressure') }}&rainin={{ states('sensor.rain_rate') }}&dailyrainin={{ states('sensor.rain_day') }}&winddir={{ states('sensor.acurite_ws_wind_direction') }}&windspeedmph={{ states('sensor.acurite_ws_wind_speed') }}&windgustmph={{ states('sensor.local_wind_gust_2_minute') }}&windspdmph_avg2m={{ states('sensor.local_wind_speed_2_minute_average') }}&winddir_avg2m={{ states('sensor.local_wind_direction_2_minute_average') }}&windgustmph_10m={{ states('sensor.local_wind_gust_10_minute') }}&UV={{ states('sensor.acurite_ws_uv_index') }}&AqPM2.5={{ states('sensor.outdoor_pm_particulate_matter_2_5um_concentration') }}&AqPM10={{ states('sensor.outdoor_pm_particulate_matter_10um_concentration') }}&action=updateraw&realtime=1&rtfreq=3"

input_boolean:
  is_raining:
    name: Currently Raining
  atlas_bad:
    name: AcuRite Atlas Offline
  rain_changeover:
    name: Rain Source Changing

timer:
  atlas_watchdog:
    name: Atlas Watchdog Timer
    duration: "00:05:00"

input_number:
  temp_high_overall:
    min: -50
    max: 150
    mode: box
  temp_low_overall:
    min: -50
    max: 150
    mode: box
  temp_high_day:
    min: -50
    max: 150
    mode: box
  temp_low_day:
    min: -50
    max: 150
    mode: box
  temp_high_week:
    min: -50
    max: 150
    mode: box
  temp_low_week:
    min: -50
    max: 150
    mode: box
  temp_high_month:
    min: -50
    max: 150
    mode: box
  temp_low_month:
    min: -50
    max: 150
    mode: box
  temp_high_year:
    min: -50
    max: 150
    mode: box
  temp_low_year:
    min: -50
    max: 150
    mode: box
  temp_high_month_1:
    min: -50
    max: 150
    mode: box
  temp_low_month_1:
    min: -50
    max: 150
    mode: box
  temp_high_month_2:
    min: -50
    max: 150
    mode: box
  temp_low_month_2:
    min: -50
    max: 150
    mode: box
  temp_high_month_3:
    min: -50
    max: 150
    mode: box
  temp_low_month_3:
    min: -50
    max: 150
    mode: box
  temp_high_month_4:
    min: -50
    max: 150
    mode: box
  temp_low_month_4:
    min: -50
    max: 150
    mode: box
  temp_high_month_5:
    min: -50
    max: 150
    mode: box
  temp_low_month_5:
    min: -50
    max: 150
    mode: box
  temp_high_month_6:
    min: -50
    max: 150
    mode: box
  temp_low_month_6:
    min: -50
    max: 150
    mode: box
  temp_high_month_7:
    min: -50
    max: 150
    mode: box
  temp_low_month_7:
    min: -50
    max: 150
    mode: box
  temp_high_month_8:
    min: -50
    max: 150
    mode: box
  temp_low_month_8:
    min: -50
    max: 150
    mode: box
  temp_high_month_9:
    min: -50
    max: 150
    mode: box
  temp_low_month_9:
    min: -50
    max: 150
    mode: box
  temp_high_month_10:
    min: -50
    max: 150
    mode: box
  temp_low_month_10:
    min: -50
    max: 150
    mode: box
  temp_high_month_11:
    min: -50
    max: 150
    mode: box
  temp_low_month_11:
    min: -50
    max: 150
    mode: box
  temp_high_month_12:
    min: -50
    max: 150
    mode: box
  temp_low_month_12:
    min: -50
    max: 150
    mode: box
  temp_high_last_day:
    min: -50
    max: 150
    mode: box
  temp_low_last_day:
    min: -50
    max: 150
    mode: box
  temp_high_last_week:
    min: -50
    max: 150
    mode: box
  temp_low_last_week:
    min: -50
    max: 150
    mode: box
  temp_high_last_month:
    min: -50
    max: 150
    mode: box
  temp_low_last_month:
    min: -50
    max: 150
    mode: box
  temp_high_last_year:
    min: -50
    max: 150
    mode: box
  temp_low_last_year:
    min: -50
    max: 150
    mode: box
  last_strike_count:
    min: 0
    max: 100000
    mode: box
  total_strike_count:
    min: 0
    max: 100000
    mode: box

input_text:
  temp_high_date_overall:
    name: Overall High Temp Date
  temp_low_date_overall:
    name: Overall Low Temp Date
  temp_high_date_day:
    name: Day High Temp Date
  temp_low_date_day:
    name: Day Low Temp Date
  temp_high_date_week:
    name: Week High Temp Date
  temp_low_date_week:
    name: Week Low Temp Date
  temp_high_date_month:
    name: Month High Temp Date
  temp_low_date_month:
    name: Month Low Temp Date
  temp_high_date_year:
    name: Year High Temp Date
  temp_low_date_year:
    name: Year Low Temp Date
  temp_high_date_month_1:
    name: Month 1 High Temp Date
  temp_low_date_month_1:
    name: Month 1 Low Temp Date
  temp_high_date_month_2:
    name: Month 2 High Temp Date
  temp_low_date_month_2:
    name: Month 2 Low Temp Date
  temp_high_date_month_3:
    name: Month 3 High Temp Date
  temp_low_date_month_3:
    name: Month 3 Low Temp Date
  temp_high_date_month_4:
    name: Month 4 High Temp Date
  temp_low_date_month_4:
    name: Month 4 Low Temp Date
  temp_high_date_month_5:
    name: Month 5 High Temp Date
  temp_low_date_month_5:
    name: Month 5 Low Temp Date
  temp_high_date_month_6:
    name: Month 6 High Temp Date
  temp_low_date_month_6:
    name: Month 6 Low Temp Date
  temp_high_date_month_7:
    name: Month 7 High Temp Date
  temp_low_date_month_7:
    name: Month 7 Low Temp Date
  temp_high_date_month_8:
    name: Month 8 High Temp Date
  temp_low_date_month_8:
    name: Month 8 Low Temp Date
  temp_high_date_month_9:
    name: Month 9 High Temp Date
  temp_low_date_month_9:
    name: Month 9 Low Temp Date
  temp_high_date_month_10:
    name: Month 10 High Temp Date
  temp_low_date_month_10:
    name: Month 10 Low Temp Date
  temp_high_date_month_11:
    name: Month 11 High Temp Date
  temp_low_date_month_11:
    name: Month 11 Low Temp Date
  temp_high_date_month_12:
    name: Month 12 High Temp Date
  temp_low_date_month_12:
    name: Month 12 Low Temp Date
  temp_high_date_last_day:
    name: Last Day High Temp Date
  temp_low_date_last_day:
    name: Last Day Low Temp Date
  temp_high_date_last_week:
    name: Last Week High Temp Date
  temp_low_date_last_week:
    name: Last Week Low Temp Date
  temp_high_date_last_month:
    name: Last Month High Temp Date
  temp_low_date_last_month:
    name: Last Month Low Temp Date
  temp_high_date_last_year:
    name: Last Year High Temp Date
  temp_low_date_last_year:
    name: Last Year Low Temp Date

automation:
  - alias: Update Temperature Records
    id: 005ecdaf-0900-447c-b13f-f1f6730ab6cb
    trigger:
      - platform: state
        entity_id: sensor.acurite_ws_temperature
    action:
      - choose: #Overall high temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) > states('input_number.temp_high_overall') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_high_overall
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_high_date_overall
              data_template:
                value: "{{ now() }}"
      - choose: #Overall low temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) < states('input_number.temp_low_overall') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_low_overall
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_low_date_overall
              data_template:
                value: "{{ now() }}"
      - choose: #Day high temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) > states('input_number.temp_high_day') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_high_day
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_high_date_day
              data_template:
                value: "{{ now() }}"
      - choose: #Day low temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) < states('input_number.temp_low_day') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_low_day
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_low_date_day
              data_template:
                value: "{{ now() }}"
      - choose: #Week high temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) > states('input_number.temp_high_week') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_high_week
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_high_date_week
              data_template:
                value: "{{ now() }}"
      - choose: #Week low temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) < states('input_number.temp_low_week') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_low_week
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_low_date_week
              data_template:
                value: "{{ now() }}"
      - choose: #Month high temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) > states('input_number.temp_high_month') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_high_month
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_number.set_value
              data_template:
                entity_id: >
                  input_number.temp_high_month_{{ now().month }}
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_high_date_month
              data_template:
                value: "{{ now() }}"
            - service: input_text.set_value
              data_template:
                entity_id: >
                  input_text.temp_high_date_month_{{ now().month }}
                value: "{{ now() }}"
      - choose: #Month low temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) < states('input_number.temp_low_month') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_low_month
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_number.set_value
              data_template:
                entity_id: >
                  input_number.temp_low_month_{{ now().month }}
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_low_date_month
              data_template:
                value: "{{ now() }}"
            - service: input_text.set_value
              data_template:
                entity_id: >
                  input_text.temp_low_date_month_{{ now().month }}
                value: "{{ now() }}"      
      - choose: #Year high temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) > states('input_number.temp_high_year') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_high_year
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_high_date_year
              data_template:
                value: "{{ now() }}"
      - choose: #Year low temperature
        - conditions:
          - condition: template
            value_template: "{{ states('sensor.acurite_ws_temperature') | float(none) < states('input_number.temp_low_year') | float(none) }}"
          sequence:
            - service: input_number.set_value
              entity_id: input_number.temp_low_year
              data_template:
                value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
            - service: input_text.set_value
              entity_id: input_text.temp_low_date_year
              data_template:
                value: "{{ now() }}"

  - alias: Reset Day Temperature
    id: 3741aeac-88e7-45db-b91a-fa032d372f08
    trigger:
      - platform: time
        at: "00:00:00"
    action:
      - service: input_number.set_value
        entity_id: input_number.temp_high_last_day
        data_template:
          value: "{{ states('input_number.temp_high_day') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_last_day
        data_template:
          value: "{{ states('input_number.temp_low_day') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_high_day
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_day
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_last_day
        data_template:
          value: "{{ states('input_text.temp_high_date_day') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_last_day
        data_template:
          value: "{{ states('input_text.temp_low_date_day') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_day
        data_template:
          value: "{{ now() }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_day
        data_template:
          value: "{{ now() }}"

  - alias: Reset Week Temperature
    id: d2ca1011-34fb-4d9d-8d60-aaefa6cfa32f
    trigger:
      - platform: time
        at: "00:00:00"
    condition:
      - condition: template
        value_template: "{{ now().weekday() == 0 }}"
    action:
      - service: input_number.set_value
        entity_id: input_number.temp_high_last_week
        data_template:
          value: "{{ states('input_number.temp_high_week') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_last_week
        data_template:
          value: "{{ states('input_number.temp_low_week') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_high_week
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_week
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_last_week
        data_template:
          value: "{{ states('input_text.temp_high_date_week') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_last_week
        data_template:
          value: "{{ states('input_text.temp_low_date_week') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_week
        data_template:
          value: "{{ now() }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_week
        data_template:
          value: "{{ now() }}"

  - alias: Reset Month Temperature
    id: 68064f64-7814-4fe6-9167-1f4bc724153a
    trigger:
      - platform: time
        at: "00:00:00"
    condition:
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: input_number.set_value
        entity_id: input_number.temp_high_last_month
        data_template:
          value: "{{ states('input_number.temp_high_month') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_last_month
        data_template:
          value: "{{ states('input_number.temp_low_month') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_high_month
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_month
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_last_month
        data_template:
          value: "{{ states('input_text.temp_high_date_month') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_last_month
        data_template:
          value: "{{ states('input_text.temp_low_date_month') | string(none) }}"
      - service: input_number.set_value
        data_template:
          entity_id: >
            input_number.temp_high_month_{{ now().month }}
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_number.set_value
        data_template:
          entity_id: >
            input_number.temp_low_month_{{ now().month }}
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_month
        data_template:
          value: "{{ now() }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_month
        data_template:
          value: "{{ now() }}"
      - service: input_text.set_value
        data_template:
          entity_id: >
            input_text.temp_high_date_month_{{ now().month }}
          value: "{{ now() }}"
      - service: input_text.set_value
        data_template:
          entity_id: >
            input_text.temp_low_date_month_{{ now().month }}
          value: "{{ now() }}" 

  - alias: Reset Year Temperature
    id: 86bdf918-9f26-4b71-87d0-5cadc1ec46c5
    trigger:
      - platform: time
        at: "00:00:00"
    condition:
      - condition: template
        value_template: "{{ now().month == 1 }}"
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: input_number.set_value
        entity_id: input_number.temp_high_last_year
        data_template:
          value: "{{ states('input_number.temp_high_year') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_last_year
        data_template:
          value: "{{ states('input_number.temp_low_year') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_high_year
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_number.set_value
        entity_id: input_number.temp_low_year
        data_template:
          value: "{{ states('sensor.acurite_ws_temperature') | float(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_last_year
        data_template:
          value: "{{ states('input_text.temp_high_date_year') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_last_year
        data_template:
          value: "{{ states('input_text.temp_low_date_year') | string(none) }}"
      - service: input_text.set_value
        entity_id: input_text.temp_high_date_year
        data_template:
          value: "{{ now() }}"
      - service: input_text.set_value
        entity_id: input_text.temp_low_date_year
        data_template:
          value: "{{ now() }}"  

  - alias: Update Wunderground
    id: 20b122c7-ee12-4734-ac22-092a80502ee0
    trigger:
      - platform: time_pattern
        seconds: "/3"
    action:
      - service: rest_command.update_wunderground

  - alias: Repeat Barometric Pressure
    id: ad3b9c6f-574e-455d-8e37-d91b8905bb12
    trigger:
      - platform: mqtt
        topic: "zigbee2mqtt/Den Climate"
    action:
    - service: mqtt.publish
      data:
        topic: weather/reports/press_in
        payload: "{{ states('sensor.den_climate_pressure') }}"

  - alias: Repeat Lightning Strike Distance
    id: 5273763b-bd68-4b07-83a5-aecb680dab29
    trigger:
      - platform: state
        entity_id: sensor.acurite_atlas_lightning_strike_count
    action:
      - choose:
        - conditions:
          - condition: template
            value_template: "{{ (states('sensor.acurite_atlas_lightning_strike_count') | int(none) - states('input_number.last_strike_count') | int(none)) > 0 }}"
          sequence:
            - repeat:
                count: "{{ states('sensor.acurite_atlas_lightning_strike_count') | int(0) - states('input_number.last_strike_count') | int(0) }}"
                sequence:
                  - service: mqtt.publish     
                    data:               
                      topic: weather/reports/lightning_distance
                      payload: "{{ states('sensor.acurite_atlas_lightning_strike_distance') }}"
                  - delay:
                      milliseconds: 500
            - service: input_number.set_value
              continue_on_error: true
              entity_id: input_number.total_strike_count
              data_template:
                value: "{{ states('input_number.total_strike_count') | int(none) + (states('sensor.acurite_atlas_lightning_strike_count') | int(none) - states('input_number.last_strike_count') | int(none)) }}"
            - service: mqtt.publish     
              data:               
                topic: weather/reports/lightning_strike_count
                payload: "{{ states('input_number.total_strike_count') }}"
        - conditions:
          - condition: template
            value_template: "{{ (states('sensor.acurite_atlas_lightning_strike_count') | int(none) < states('input_number.last_strike_count') | int(none)) and (states('sensor.acurite_atlas_lightning_strike_count') | int(none) > 0) }}"
          sequence:
            - repeat:
                count: "{{ states('sensor.acurite_atlas_lightning_strike_count') | int(0) - states('input_number.last_strike_count') | int(0) }}"
                sequence:
                  - service: mqtt.publish     
                    data:               
                      topic: weather/reports/lightning_distance
                      payload: "{{ states('sensor.acurite_atlas_lightning_strike_distance') | int(0)  }}"
                  - delay:
                      milliseconds: 500
            - service: input_number.set_value
              continue_on_error: true
              entity_id: input_number.total_strike_count
              data_template:
                value: "{{ states('input_number.total_strike_count') | int(none) + states('sensor.acurite_atlas_lightning_strike_count') | int(none) }}"
            - service: mqtt.publish     
              data:               
                topic: weather/reports/lightning_strike_count
                payload: "{{ states('input_number.total_strike_count') | int(0) }}"
      - service: input_number.set_value
        entity_id: input_number.last_strike_count 
        data_template:
          value: "{{ states('sensor.acurite_atlas_lightning_strike_count') | int(0) }}"

  - alias: Send Rain Counts to MQTT
    id: e8cf37b4-9b4f-462c-ae83-8c3e9144fc3b
    trigger:
      - platform: state
        entity_id:
          - sensor.rain_hour
          - sensor.rain_day
          - sensor.rain_week
          - sensor.rain_month
          - sensor.rain_year
          - sensor.rain_rate
      - platform: time_pattern
        minutes: "/15"
    action:
    - service: mqtt.publish
      data:
        topic: weather/reports/rain_hour
        payload: "{{ states('sensor.rain_hour') }}"
    - service: mqtt.publish
      data:
        topic: weather/reports/rain_day
        payload: "{{ states('sensor.rain_day') }}"
    - service: mqtt.publish
      data:
        topic: weather/reports/rain_week
        payload: "{{ states('sensor.rain_week') }}"
    - service: mqtt.publish
      data:
        topic: weather/reports/rain_month
        payload: "{{ states('sensor.rain_month') }}"
    - service: mqtt.publish
      data:
        topic: weather/reports/rain_year
        payload: "{{ states('sensor.rain_year') }}"
    - service: mqtt.publish
      data:
        topic: weather/reports/rain_rate
        payload: "{{ states('sensor.rain_rate') }}"

  - alias: Reset AcuRite Atlas Watchdog
    id: b5b29022-a2c0-434e-9d76-152864920e93
    trigger:
      - platform: mqtt
        topic: rtl_433-shed/157/battery_ok
    action:
      - service: timer.start
        entity_id: timer.atlas_watchdog      
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.atlas_bad
            state: "on"
          sequence:
            - service: input_boolean.turn_on
              entity_id: input_boolean.rain_changeover
            - delay:
                seconds: 1
            - service: input_boolean.turn_off
              entity_id: input_boolean.atlas_bad

  - alias: Start AcuRite Atlas Watchdog Timer on HA Start
    id: 94cff976-39a3-4dde-92fb-abd0d11d9762
    trigger:
      - event: start
        platform: homeassistant
    condition:
      - condition: state
        entity_id: input_boolean.atlas_bad
        state: "off"
    action:
      - service: timer.start
        entity_id: timer.atlas_watchdog      

  - alias: Move to Backup Weather Sensors When AcuRite Atlas Fails
    id: 7fafdc5d-f85a-4801-8fe7-5bc13107cc40
    trigger:
      - platform: event
        event_type: timer.finished
        event_data:
          entity_id: timer.atlas_watchdog
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.rain_changeover
      - delay:
          seconds: 1
      - service: input_boolean.turn_on
        entity_id: input_boolean.atlas_bad
