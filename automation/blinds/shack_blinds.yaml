- alias: Open Shack Blinds
  trigger:
    - platform: state
      entity_id: switch.shack_blinds
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: cover.shack_blinds
      state: 'closed'
  action:
    - service: cover.open_cover
      entity_id: cover.shack_blinds

- alias: Close Shack Blinds
  trigger:
    - platform: state
      entity_id: switch.shack_blinds
      from: 'on'
      to: 'off'
  condition:
    - condition: state
      entity_id: cover.shack_blinds
      state: 'open'
  action:
    - service: cover.close_cover
      entity_id: cover.shack_blinds

- alias: Shack Blind Keypad on if any Open
  trigger:
    - platform: state
      entity_id: cover.shack_blinds
      from: 'closed'
      to: 'open'
  condition:
    - condition: state
      entity_id: switch.shack_blinds
      state: 'off'
  action:
    - service: switch.turn_on
      entity_id: switch.shack_blinds
    

- alias: Shack Blind Keypad off if all Closed
  trigger:
    - platform: state
      entity_id: cover.shack_blinds
      from: 'open'
      to: 'closed'
  condition:
    - condition: state
      entity_id: switch.shack_blinds
      state: 'on'
  action:
    - service: switch.turn_off
      entity_id: switch.shack_blinds

- alias: Shack Windows Same Position
  trigger:
    - platform: state
      entity_id:
        - cover.center_shack_blind
        - cover.right_shack_blind
        - cover.left_shack_blind
      from: 'closed'
      to: 'open'
    - platform: state
      entity_id:
        - cover.center_shack_blind
        - cover.right_shack_blind
        - cover.left_shack_blind
      from: 'open'
      to: 'closed'
  condition:
    - condition: template
      value_template: "{{ states('cover.center_shack_blind') == states('cover.right_shack_blind') == states('cover.left_shack_blind') }}"
    - condition: template
      value_template: "{{ not is_state('cover.center_shack_blind', 'unavailable') }}"
    - condition: template
      value_template: "{{ not is_state('cover.left_shack_blind', 'unavailable') }}"
    - condition: template
      value_template: "{{ not is_state('cover.right_shack_blind', 'unavailable') }}"
  action:
    - service: mqtt.publish
      data:
        payload_template: "{{ state_attr('cover.center_shack_blind', 'current_position') }}"
        topic: habc/shack/tele/currentpct
        retain: 'true'

- alias: Shack Windows Various Positions
  trigger:
    - platform: state
      entity_id:
        - cover.center_shack_blind
        - cover.right_shack_blind
        - cover.left_shack_blind
      from: 'closed'
      to: 'open'
    - platform: state
      entity_id:
        - cover.center_shack_blind
        - cover.right_shack_blind
        - cover.left_shack_blind
      from: 'open'
      to: 'closed'
  condition:
    - condition: template
      value_template: "{{ not states('cover.center_shack_blind') == states('cover.right_shack_blind') == states('cover.left_shack_blind') }}"
    - condition: template
      value_template: "{{ not is_state('cover.center_shack_blind', 'unavailable') }}"
    - condition: template
      value_template: "{{ not is_state('cover.left_shack_blind', 'unavailable') }}"
    - condition: template
      value_template: "{{ not is_state('cover.right_shack_blind', 'unavailable') }}"
  action:
    - service: mqtt.publish
      data:
        payload: 95
        topic: habc/shack/tele/currentpct
        retain: 'true'